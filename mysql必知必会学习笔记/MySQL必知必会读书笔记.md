[TOC]
# 第１章 了解sql #
## 1.1 数据库基础 ##
### 1.1.1 什么是数据库 ###
**数据库（database）** 保存有组织的数据的容器（通常是一个文件或一组文件）。

> 数据库软件应称为DBMS（数据库管理系统），数据库是通过DBMS创建和操纵的容器。 

### 1.1.2 表 ###
**表（table）**某种特定类型数据的结构化清单。

	表名 表名的唯一性取决于多个因素， 如数据库名和表名等的
	结合。 这表示， 虽然在相同数据库中不能两次使用相同的表名，
	但在不同的数据库中却可以使用相同的表名。

**模式（schema）**关于数据库和表的布局及特性的信息。

	表具有一些特性，这些特性定义了数据在表中如何存储，如可以存
	储什么样的数据，数据如何分解，各部分信息如何命名，等等。描述表
	的这组信息就是所谓的模式，模式可以用来描述数据库中特定的表以及
	整个数据库（和其中表的关系） 。

### 1.1.3 列和数据类型 ###
**列（column）**表中的一个字段。所有表都是由一个或多个列组成的。

**数据类型（datatype）**所容许的数据的类型。每个表列都有相应的数据类型，它限制（或容许）该列中存储的数据。

	数据类型限制可存储在列中的数据种类（例如，防止在数值字段中录入字符值） 。
    数据类型还帮助正确地排序数据，并在优化磁盘使用方面起重要的作用。

### 1.1.4 行 ###
	**行（row）**表中的一个记录。

### 1.1.5 主键 ###
**主键（primary key）**一一列（或一组列） ，其值能够唯一区分表中每个行。

	唯一标识表中每行的这个列（或这组列）称为主键。主键用来表示一个特定的行。
	没有主键，更新或删除表中特定行很困难，因为没有安全的方法保证只涉及相关的行。

**表中的任何列都可以作为主键，只要它满足以下条件：**

- 任意两行都不具有相同的主键值；
- 每个行都必须具有一个主键值（主键列不允许NULL值） 。

**主键的最好习惯：**

- 不更新主键列中的值；
- 不重用主键列的值；
- 不在主键列中使用可能会更改的值。 （例如，如果使用一个 名字作为主键以标识某个供应商， 当该供应商合并和更改其名字时，必须更改这个主键。）

## 1.2 什么是SQL ##
**SQL（发音为字母S-Q-L或sequel） 是结构化查询语言 （Structured Query Language）的缩写。SQL是一种专门用来与数据库通信的语言。**


# 第 2 章 MySQL简介 #
**数据的所有存储、检索、管理和处理实际上是由数据库软件——DBMS（数据库管理系统）完成的。MySQL是一种DBMS，即它是一种数据库软件。**

为了给出用户名、主机名、端口和口令，应该使用 mysql -u ben -p -h myserver -P 9999

输入 help select 获得使用 SELECT 语句的帮助

# 第３章 使用MySQL #
## 3.1 连接 ##
为了连接到MySQL，需要以下信息：

- 主机名 （计算机名） ——如果连接到本地MySQL服务器， 为 localhost；
- 端口（如果使用默认端口3306之外的端口）；
- 一个合法的用户名；
- 用户口令（如果需要）。

## 3.2 选择数据库 ##
使用 **USE 关键字**。

	use databases;

关键字(key word) 作为MySQL语言组成部分的一个**保留字**。**决不要用关键字命名一个表或列**。

**ps:必须先使用 USE 打开数据库，才能读取其中的数据。**

## 3.3 了解数据库和表 ##
数据库、 表、 列、 用户、 权限等的信息被存储在数据库和表中 （MySQL使用MySQL来存储这些信息） 。不过，内部的表一般不直接访问。
可用MySQL的 **SHOW 命令**来显示这些信息 （MySQL从内部表中提取这些信息） 。

**SHOW DATABASES**; 返回可用数据库的一个列表。

为了获得一个数据库内的表的列表，使用 **SHOW TABLES**;

SHOW 也可以用来显示表列:**SHOW COLUMNS** FROM CUSTOMERS;

	SHOW COLUMNS 要 求 给 出一 个 表 名 （这 个 例 子 中的 FROMcustomers ） ，它对每个字段返回一行，
    行中包含字段名、数据类型、是否允许 NULL 、键信息、默认值以及其他信息（如字段 cust_id的auto_increment ）

	MySQL支持用 DESCRIBE 作为 SHOW COLUMNSFROM 的一种快捷方式。
	换句话说， DESCRIBE customers; 是SHOW COLUMNS FROM customers; 的一种快捷方式。

 SHOW 语句还有：

- SHOW STATUS ，用于显示广泛的服务器状态信息；
- SHOW CREATE DATABASE和SHOW CREATE TABLE ，分别用来显示创建特定数据库或表的MySQL语句；
- SHOW GRANTS ，用来显示授予用户（所有用户或特定用户）的安全权限；
- SHOW ERRORS 和 SHOW WARNINGS ， 用来显示服务器错误或警告消息。

命令**HELP SHOW**; 显示允许的 SHOW 语句。

# 第 4 章 检 索 数 据 #
## 4.1 SELECT 语句 ##
**它的用途是从一个或多个表中检索信息。**

多条SQL语句必须以分号（； ）分隔

## 4.6 限制结果 ##
为了返回第一行或前几行，可使用 **LIMIT** 子句

	//初始记录行的偏移量是 0(而不是 1)：
	　　mysql> SELECT * FROM table LIMIT 5,10; //检索记录行6-15
	
	//为了检索从某一个偏移量到记录集的结束所有的记录行，可以指定第二个参数为 -1：
	mysql> SELECT * FROM table LIMIT 95,-1; // 检索记录行 96-last
	
	//如果只给定一个参数，它表示返回最大的记录行数目。换句话说，LIMIT n 等价于 LIMIT 0,n：
	mysql> SELECT * FROM table LIMIT 5;     //检索前 5 个记录行

为了与 PostgreSQL 兼容，MySQL 也支持句法： LIMIT # OFFSET #。

	比如下面的sql语句：
	　　　　① selete * from testtable limit 2,1;
	　　　　② selete * from testtable limit 2 offset 1;
	　　注意：
	　　　　1.数据库数据计算是从0开始的
	　　　　2.offset X是跳过X个数据，limit Y是选取Y个数据
	　　　　3.limit  X,Y  中X表示跳过X个数据，读取Y个数据
	　　这两个都是能完成需要，但是他们之间是有区别的：
	　　　　①是从数据库中第三条开始查询，取一条数据，即第三条数据读取，一二条跳过
	　　　　②是从数据库中的第二条数据开始查询两条数据，即第二条和第三条。

# 第５章 排序检索数据 #
为了明确地排序用 SELECT 语句检索出的数据，可使用 **ORDER BY** 子句。ORDER BY 子句取**一个或多个列**的名字，据此对输出进行排序。

## 5.2 按多个列排序 ##
	SELECT * FROM product ORDER BY prod_price,prod_name;
	
	仅在多个行具有相同的 prod_price值时才对产品按 prod_name 进行排序。 
	如果 prod_price 列中所有的值都是唯一的，则不会按 prod_name 排序。

**在多个列上降序排序 如果想在多个列上进行降序排序， 必须对每个列指定 DESC 关键字。**

**ORDER BY 子句的位置: 在给出 ORDER BY 子句时，应该保证它位于 FROM 子句之后。如果使用 LIMIT ，它必须位于 ORDER BY之后。**

# 第６章 过 滤 数 据 #
## 6.1 使用 WHERE 子句 ##
数据库表一般包含大量的数据，很少需要检索表中所有行。通常只会根据特定操作或报告的需要提取表数据的子集。只检索所需数据需要指定搜索条件（search criteria），搜索条件也称为过滤条件（filter condition）.

## 6.2.4 空值检查 ##
SELECT 语句有一个特殊的 WHERE 子句，可用来检查具有 NULL 值的列。这个 WHERE 子句就是 **IS NULL** 子句。

	NULL 无值（no value） ，它与字段包含 0 、空字符串或仅仅包含空格不同。

# 第 7 章 数 据 过 滤 #
## 7.1 组合 WHERE 子句 ##
MySQL允许给出多个 WHERE 子句。这些子句可以两种方式使用：以**AND 子句的方式或 OR 子句的方式使用。**

**操作符（operator）**: 用来联结或改变 WHERE 子句中的子句的关键字。也称为**逻辑操作符**（logical operator）

### 7.1.3 计算次序 ###
SQL（像多数语言一样）在处理 OR 操作符前，**优先处理 AND 操作符**。

	在WHERE子句中使用圆括号 任何时候使用具有 AND 和 OR 操作符的 WHERE 子句，都应该使用圆括号明确地分组操作符。
	不要	过分依赖默认计算次序，即使它确实是你想要的东西也是如	此。使用圆括号没有什么坏处，它能消除歧义。

## 7.2 IN 操作符 ##
**IN 操作符完成与 OR 相同的功能**

**WHERE 子句中用来指定要匹配值的清单的关键字，功能与 OR相当 。**

**为什么要使用 IN 操作符？其优点具体如下。**

- 在使用长的合法选项清单时， IN 操作符的语法更清楚且更直观。
- 在使用 IN 时，计算的次序更容易管理（因为使用的操作符更少） 。
- IN 操作符一般比 OR 操作符清单执行更快。
- IN 的最大优点是可以包含其他 SELECT 语句，使得能够更动态地建立 WHERE 子句。

## 7.3 NOT 操作符 ##
**WHERE 子句中的 NOT 操作符有且只有一个功能，那就是否定它之后所跟的任何条件**。

	MySQL中的NOT
    MySQL支持使用 NOT 对 IN 、 BETWEEN 和	EXISTS子句取反，
	这与多数其他 DBMS允许使用 NOT 对各种条件取反有很大的差别。

# 第 8 章 用通配符进行过滤 #
## 8.1 LIKE 操作符 ##
**通配符（wildcard）** 用来匹配值的一部分的特殊字符。

**搜索模式（search pattern）** 由字面值、通配符或两者组合构成的搜索条件。

**为在搜索子句中使用通配符，必须使用 LIKE 操作符**。 LIKE 指示MySQL,后跟的搜索模式利用通配符匹配而不是直接相等匹配进行比较。

### 8.1.1 百分号（ % ）通配符 ###
**除了一个或多个字符外， % 还能匹配0个字符。**

**注意尾空格** 尾空格可能会干扰通配符匹配。

 % 通配符可以匹配任何东西，但有一个例外，**即 NULL** 。

### 8.1.2 下划线（ _ ）通配符 ###
下划线的用途与 % 一样，但下划线只匹配**单个字符**。

## 8.2 使用通配符的技巧 ##
MySQL的通配符很有用。但这种功能是有代价的：**通配符搜索的处理一般要比前面讨论的其他搜索所花时间更长**。

使用通配符要记住的技巧:

-  不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。
- 在确实需要使用通配符时，除非绝对有必要，否则不要把它们用在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起来是最慢的。
- 仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。

# 第 9 章 用正则表达式进行搜索 #
## 9.1 正则表达式介绍 ##
所有种类的程序设计语言、文本编辑器、操作系统等都支持正则表达式。

### 9.2.1 基本字符匹配 ###
    SELECT prod_name FROM products WHERE prod_name EXGEXP '1000' ODER BY  pro_name;
    输出： pro_name
          JePack 1000

 **REGEXP** 后所跟的东西作为正则表达式（与文字正文 1000 匹配的一个正则表达式）处理.

### 9.2.2 进行OR匹配 ###
为搜索两个串之一（或者为这个串，或者为另一个串） ，使用 |

    SELECT prod_name FROM products WHERE prod_name REGEXP '1000|2000' ORDER BY  prod_name;
    两个以上的 OR 条件 可以给出两个以上的 OR 条件。例如，'1000 | 2000 | 3000' 将匹配 1000 或 2000 或 3000 。

### 9.2.3 匹配几个字符之一 ###
可通过指定一组用 [ 和 ] 括起来的字符来完成

    SELECT prod_name FROM products WHERE prod_name REGEXP '[123] Ton' ORDER BY  prod_name;
    输出： pro_name
          1 ton anvil
          2 ton anvil
 	[123] 定义一组字符，它的意思是匹配 1 或 2 或 3 
	[123]匹配字符 1 、 2 或 3 ，但 [^123] 却匹配除这些字符外的任何东西

 	[] 是另一种形式的 OR 语句
	SELECT prod_name FROM products WHERE prod_name REGEXP '(1|2|3) Ton' ORDER BY  prod_name;

### 9.2.4 匹配范围 ###
- [0-9]匹配数字0到9
- [a-z] 匹配任意字母字符
- .是正则表达式语言中一个特殊的字符。它表示匹配任意一个字符,如： .000 ，则 1000 和 2000 都匹配

### 9.2.5 匹配特殊字符 ###
**为了匹配特殊字符， 必须用 \\ 为前导。 \\- 表示查找 - ， \\. 表示查找 . 。**

    SELECT vend_name FROM vendors WHERE vend_name REGEXP '\\.'
	输出 vend_name
	    Furball Inc.

**这种处理就是所谓的转义（escaping） ，正则表达式内具有特殊意义的所有字符都必须以这种方式转义。这包括 . 、 | 、 [] 以及迄今为止使用过的其他特殊字符。**
	
**匹配 \ 为了匹配反斜杠（ \ ）字符本身，需要使用 \\\ 。**

	简单的正则表达式测试 可以在不使用数据库表的情况下用SELECT 来测试正则表达式。 
	REGEXP 检查总是返回 0 （没有匹配）或 1 （匹配）。
	可以用带文字串的 REGEXP 来测试表达式，并试验它们。
    SELECT 'hello' REGEXP '[0-9]';



# 第 10 章 创建计算字段 #
## 10.1 计算字段 ##
存储在数据库表中的数据一般不是应用程序所需要的格式。

## 10.2 拼接字段 ##
可使用**Concat()** 函数来拼接两个列

通过删除数据右侧多余的空格来整理数据，这可以使用MySQL的 **RTrim()** 函数来完成

**LTrim() （去掉串左边的空格）**以及**Trim() （去掉串左右两边的空格）** 

	SELECT 提供了测试和试验函数与计算的一个	很好的办法。虽然 SELECT 通常用来从表中检索数据，但可以
	省略 FROM 子句以便简单地访问和处理表达式。
	例如， SELECT3*2; 将返回 6 ， 
	SELECT Trim('abc'); 将返回 abc ，
	而 SELECTNow() 利用 Now() 函数返回当前日期和时间。
	通过这些例子，可以明白如何根据需要使用 SELECT 进行试验

# 第 11 章 使用数据处理函数 #
## 11.2 使用函数 ##
### 11.2.1 文本处理函数 ###
常用的文本处理函数函数说明

- **Left()**  返回串左边的字符
- **Length()**  返回串的长度
- **Locate()**  找出串的一个子串
- **Lower()**  将串转换为小写
- **LTrim()**  去掉串左边的空格
- **Right()**  返回串右边的字符
- **RTrim()**  去掉串右边的空格
- **Soundex()**  返回串的SOUNDEX值
- **SubString()**  返回子串的字符
- **Upper()**  将串转换为大写

 **SOUNDEX 是一个将任何文本串转换为描述其语音表示的字母数字模式的算法。 SOUNDEX 考虑了类似的发音字符和音节，使得能对串进行发音比较而不是字母比较。**

### 11.2.2 日期和时间处理函数 ###
日期和时间采用相应的数据类型和特殊的格式存储，以便能快速和有效地排序或过滤，并且节省物理存储空间.

一般，应用程序不使用用来存储日期和时间的格式，因此**日期和时间函数总是被用来读取、统计和处理这些值**。由于这个原因，日期和时间函数在MySQL语言中具有重要的作用。

常用日期和时间处理函数

- **AddDate()**  增加一个日期（天、周等）
- **AddTime()**  增加一个时间（时、分等）
- **CurDate()**  返回当前日期
- **CurTime()**  返回当前时间
- **Date()**  返回日期时间的日期部分
- **DateDiff()**  计算两个日期之差
- **Date_Add()**  高度灵活的日期运算函数
- **Date_Format()**  返回一个格式化的日期或时间串
- **Day()**  返回一个日期的天数部分
- **DayOfWeek()**  对于一个日期，返回对应的星期几
- **Hour()**  返回一个时间的小时部分
- **Minute()**  返回一个时间的分钟部分
- **Month()**  返回一个日期的月份部分
- **Now()**  返回当前日期和时间
- **Second()**  返回一个时间的秒部分
- **Time()**  返回一个日期时间的时间部分
- **Year()**  返回一个日期的年份部分

### 11.2.3 数值处理函数 ###
常用数值处理函数

- **Abs()**  返回一个数的绝对值
- **Cos()**  返回一个角度的余弦
- **Exp()**  返回一个数的指数值
- **Mod()**  返回除操作的余数
- **Pi()**  返回圆周率
- **Rand()**  返回一个随机数
- **Sin()**  返回一个角度的正弦
- **Sqrt()**  返回一个数的平方根
- **Tan()**  返回一个角度的正切

# 第 12 章 汇总数据 #
## 12.1 聚集函数 ##
**聚集函数**（aggregate function） 运行在行组上，计算和返回单个值的函数。

MySQL给出了5个聚集函数：

- AVG()    返回某列的平均值
- COUNT()  返回某列的行数
- MAX()    返回某列的最大值,**函数忽略列值为 NULL 的行**
- MIN()    返回某列的最小值,**函数忽略列值为 NULL 的行**
- SUM()    返回某列值之和,**函数忽略列值为 NULL 的行**。

ps:**AVG() 函数忽略列值为 NULL 的行。**

### 12.1.2 COUNT()函数 ###
COUNT() 函数有两种使用方式。

- 1.使用 COUNT(*) 对表中行的数目进行计数,不管表列中包含的是空值（NULL）还是非空值。
- 2.使用 COUNT(column) 对特定列中具有值的行进行计数，忽略**NULL** 值

### 12.1.3 MAX()函数 ###

**对非数值数据使用 MAX()** 

虽然 MAX() 一般用来找出最大的数值或日期值，但MySQL允许将它用来返回任意列中的最大值，包括返回文本列中的最大值。
**在用于文本数据时，如果数据按相应的列排序，则 MAX() 返回最后一行**

### 12.1.4 MIN()函数 ###
**对非数值数据使用 MIN()** 

MIN() 函数与 MAX() 函数类似，MySQL允许将它用来返回任意列中的最小值，包括返回文本列中的最小值。 
**在用于文本数据时， 如果数据按相应的列排序，则 MIN() 返回最前面的行。**

## 12.2 聚集不同值 ##
以上5个聚集函数都可以如下使用：

- 对所有的行执行计算，指定 **ALL** 参数或不给参数（因为 ALL 是默认行为）；
- 只包含不同的值，指定 **DISTINCT** 参数。

**注意** 如果指定列名， 则 DISTINCT 只能用于 COUNT() 。 DISTINCT不能用于 COUNT(*)，因此不允许使用COUNT（DISTINCT），否则会产生错误 。类似地， DISTINCT 必须使用列名，不能用于计算或表达式。

# 第 13 章 分组数据 #
## 13.2 创建分组 ##
在具体使用 GROUP BY 子句前，需要知道一些重要的规定。

- 1.GROUP BY 子句可以包含任意数目的列。 这使得能对分组进行嵌套，为数据分组提供更细致的控制。
- 2.如果在 GROUP BY 子句中嵌套了分组，数据将在最后规定的分组上进行汇总。换句话说，在建立分组时，指定的所有列都一起计算（所以不能从个别的列取回数据） 。
- 3.GROUP BY 子句中列出的每个列都必须是检索列或有效的表达式（但不能是聚集函数） 。**如果在 SELECT 中使用表达式，则必须在GROUP BY 子句中指定相同的表达式。不能使用别名**。
- 4.**除聚集计算语句外， SELECT 语句中的每个列都必须在 GROUP BY 子句中给出。**
- 5.如果分组列中具有 NULL 值，则 NULL 将作为一个分组返回。如果列中有多行 NULL 值，它们将分为一组。
- 6.**GROUP BY 子句必须出现在 WHERE 子句之后， ORDER BY 子句之前。**

**使用 ROLLUP** 使用 WITH ROLLUP 关键字，可以得到每个分组以及每个分组汇总级别（针对每个分组）的值

## 13.3 过滤分组 ##
 **HAVING 过滤分组**

**HAVING支持所有WHERE操作符**,有关**WHERE**的所有这些技术和选项都适用于**HAVING** 。它们的句法是相同的，只是关键字有差别。

**HAVING 和 WHERE 的差别** 这里有另一种理解方法,**WHERE 在数据分组前进行过滤**,HAVING 在数据分组后进行过滤。这是一个重要的区别， **WHERE 排除的行不包括在分组中**。

## 13.4 分组和排序 ##
虽然 GROUP BY 和 ORDER BY 经常完成相同的工作，但它们是非常不同的

RDER BY

- 1.排序产生的输出 
- 2.任意列都可以使用 （甚至非选择的列也可以使用）
- 3.不一定需要

ORDER BY

- 1.分组行。但输出可能不是分组的顺序
- 2.只可能使用选择列或表达式列，而且必须使用每个选择列表达式
- 3.如果与聚集函数一起使用列（或表达式），则必须使用


不要忘记 ORDER BY **一般在使用 GROUP BY 子句时，应该也给出 ORDER BY 子句。**这是保证数据正确排序的唯一方法。千万不要仅依赖 GROUP BY 排序数据。

## 13.5 SELECT子句顺序 ##

	子句       说 明                              是否必须使用
	SELECT   要返回的列或表达式                       是
	FROM     从中检索数据的表                   仅在从表选择数据时使用
	WHERE     行级过滤                               否
	GROUP BY  分组说明                         仅在按组计算聚集时使用
	HAVING    组级过滤                                 否
	ORDER BY  输出排序顺序                            否
	LIMIT     要检索的行数                            否

# 第 14 章 使用子查询 #